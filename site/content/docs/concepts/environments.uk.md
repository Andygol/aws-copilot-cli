---
title: Середовища
---

# Середовища

Коли ви вперше запускаєте `copilot init`, вас запитують, чи хочете ви створити _тестове_ середовище. Це тестове середовище містить усі ресурси AWS для забезпечення захищеної мережі (VPC, підмережі, групи безпеки та інше), а також інші ресурси, які призначені для спільного використання між кількома сервісами, такі як Application Load Balancer або ECS Cluster. Коли ви розгортаєте свій сервіс у _тестовому_ середовищі, ваш сервіс використовуватиме мережу та ресурси _тестового_ середовища. Ваш застосунок може мати кілька середовищ, і кожне з них матиме власну мережеву та спільну інфраструктуру ресурсів.

Хоча Copilot створює для вас тестове середовище на початку роботи, для промислової експлуатації зазвичай створюється нове, окреме середовище. Це промислове середовище буде повністю незалежним від тестового середовища, з власною мережею та копією сервісів. Маючи як тестове, так і промислове середовище, ви можете розгортати зміни в тестовому середовищі, перевіряти їх, а потім переносити їх у промислове середовище.

На діаграмі нижче ми маємо застосунок з назвою _MyApp_ з двома сервісами, _API_ та _Backend_. Ці два сервіси розгорнуті у двох середовищах, _test_ та _prod_. Ви можете побачити, що в _test_ середовищі обидва сервіси працюють лише в одному контейнері, тоді як у _prod_ середовищі сервіси мають більше контейнерів. Сервіси можуть використовувати різні конфігурації залежно від середовища, в якому вони розгорнуті. Для отримання додаткової інформації перегляньте посібник [використання змінних середовища](../../developing/environment-variables/).

![](https://user-images.githubusercontent.com/879348/85873795-7da9c480-b786-11ea-9990-9604a3cc5f01.png)

## Створення середовища

Щоб створити нове середовище у вашому застосунку, ви можете запустити `copilot env init` з вашого робочого простору. Copilot запитає вас, як ви хочете назвати це середовище та який профіль ви бажаєте використовувати для його налаштування. Ці профілі є [іменованими профілями AWS](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html), які повʼязані з певним обліковим записом та регіоном. Коли ви вибираєте один з цих профілів, ваше середовище буде створено в обліковому записі та регіоні, з якими повʼязаний цей профіль.

```console
copilot env init
```

Після запуску `copilot env init`, ви можете спостерігати, як Copilot налаштовує дві IAM ролі, які є необхідними для оновлення та управління середовищем. Якщо середовище було створено з іншим обліковим записом AWS, ніж застосунок, середовище буде повʼязане з обліковим записом застосунку; це дозволяє акторам в обліковому записі застосунку керувати середовищем, навіть без доступу до облікового запису середовища. Copilot створює [env manifest](../../manifest/environment/) у `copilot/environments/[env name]/manifest.yml`.

## Розгортання середовища

Якщо ви хочете, ви можете налаштувати своє середовище, змінивши ваш [env manifest](../../manifest/environment/) перед його розгортанням:

```console
copilot env deploy
```

На цьому етапі Copilot створює ресурси інфраструктури вашого середовища, такі як кластер ECS, групу безпеки та приватний простір імен DNS. Після розгортання ви можете змінити свій env manifest і повторно розгорнути його, просто запустивши [`copilot env deploy`](../../commands/env-deploy/) знову.

### Розгортання сервісу

Коли ви вперше створюєте нове середовище, жодні сервіси не розгорнуті в ньому. Щоб розгорнути сервіс, запустіть `copilot deploy` з теки цього сервісу, і вам буде запропоновано вибрати, в яке середовище розгортати.

## Інфраструктура середовища

![](https://user-images.githubusercontent.com/879348/85873802-800c1e80-b786-11ea-8b2c-779b01abbaf4.png)


### VPC та мережа

Кожне середовище отримує власний VPC з кількома зонами доступності (multi-AZ). Ваш VPC — це мережевий кордон вашого середовища, який пропускає трафік, який ви очікуєте, і блокує решту. VPC, створені Copilot, розподілені по двох зонах доступності, кожна з яких отримує публічну та приватну підмережу, відповідно до [найкращих практик AWS](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-best-practices.html). Стандартно ваші сервіси запускаються в загальнодоступних підмережах, обмежуючи доступ лише до інших сервісів у вашому середовищі з метою безпеки. Завдання розміщуються в публічних підмережах, щоб допомогти керувати витратами, дозволяючи вихід в інтернет без необхідності використання NAT шлюзу.

Розміщення підмережі робочого навантаження можна змінити за допомогою поля [`network.vpc.placement`](../../manifest/lb-web-service/#network-vpc-placement) у маніфесті.

### Балансувальники навантаження та DNS <a name="load-balancers-and-dns"></a>

Якщо ви налаштували вебсервіс з балансуванням навантаження або бекенд-сервіс з полем `http` у його маніфесті, Copilot налаштує балансувальник навантаження застосунків (ALB), який буде спільним для всіх сервісів з балансуванням навантаження в цьому середовищі. ALB вебсервісів з балансуванням навантаження є інтернет-орієнтованими, тоді як ALB бекенд-сервісів є внутрішніми. Ваш балансувальник навантаження може спілкуватися з іншими сервісами Copilot у вашому VPC.

За бажанням, коли ви налаштовуєте застосунок, ви можете надати доменне імʼя, яким ви володієте та яке зареєстроване в Route 53. Якщо ви надаєте доменне імʼя, кожного разу, коли ви створюєте середовище, Copilot створить піддомен environment-name.app-name.your-domain.com, забезпечить сертифікат ACM та привʼяже його до вашого балансувальника навантаження застосунків, щоб він міг використовувати HTTPS.

Внутрішній ALB створюється, коли бекенд-сервіс з налаштованим [`http`](../../manifest/backend-service/#http) у його маніфесті розгортається в середовищі. Для точки доступу HTTPS використовуйте прапорець [`--import-cert-arns`](../../commands/env-init/#what-are-the-flags) під час запуску `copilot env init` та імпортуйте VPC лише з приватними підмережами. Для отримання додаткової інформації про внутрішні ALB, перейдіть [сюди](../../developing/internal-albs/).

Якщо у вас вже є ALB у вашому VPC і ви хочете використовувати його замість того, щоб дозволити Copilot створити новий, вкажіть цей ALB за назвою або ARN у маніфесті вашого вебсервісу з балансуванням навантаження (для інтернет-орієнтованих ALB) або бекенд-сервісу (для внутрішніх ALB) перед розгортанням його в середовище:

```yaml
http:
  path: '/'
  alb: [name or ARN]
```

Ваш імпортований ALB буде повʼязаний лише з цим сервісом (та іншими, які аналогічно імпортують його), а не спільним для всіх сервісів з балансуванням навантаження в середовищі.

## Налаштування вашого середовища

Ви можете імпортувати наявні ресурси середовища або налаштувати стандартні за допомогою прапорців з командами або змінивши ваш [env manifest](../../manifest/environment/). Якщо ви хочете налаштувати більше типів ресурсів, ніж зараз доступно для налаштування, не соромтеся поділитися своїми випадками використання та створити тікет!

Для отримання додаткової інформації дивіться нашу сторінку [налаштування ресурсів середовища](../../developing/custom-environment-resources/).

## Дослідження вашого середовища

Тепер, коли ми створили середовище, ми можемо перевірити його за допомогою Copilot. Нижче наведено кілька поширених способів перевірки вашого середовища.

### Які середовища є частиною мого застосунку?

Щоб побачити всі середовища у вашому застосунку, ви можете запустити `copilot env ls`.

```console
$ copilot env ls
test
production
```

### Що є у вашому середовищі?

Запуск `copilot env show` покаже вам опис вашого середовища. Ось приклад виводу, який ви можете побачити для нашого тестового середовища. Цей вивід включає обліковий запис та регіон, у якому знаходиться середовище, сервіси, розгорнуті в цьому середовищі, та теґ, який матимуть усі ресурси, створені в цьому середовищі. Ви також можете надати додатковий прапорець `--resources`, щоб побачити всі ресурси AWS, повʼязані з цим середовищем.

```console
$ copilot env show --name test
About

  Name              test
  Region            us-west-2
  Account ID        693652174720

Workloads

  Name              Type
  ----              ----
  api               Load Balanced Web Service
  backend           Backend Service


Tags

  Key                  Value
  ---                  -----
  copilot-application  my-app
  copilot-environment  test
```
